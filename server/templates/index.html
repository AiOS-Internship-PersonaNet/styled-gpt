<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlaskGPT</title>
</head>

<body>
    <header>
        <div class="container">
            <a href="" class="planes-links">FlaskGPT</a>
        </div>
    </header>

    <div>
        <h2 class="pod-h2">QA with ChatGPT, Langchain and Flask</h2>
        <h3 class="pod-h3">Stream responses like this:</h3>
    </div>
    <section class="buscar">
        <div class="search-container">
            <form id="input-form" method="POST" class="d-flex">
                <input type="text" name="input_text" maxlength="500" class="d-flex">
            </form>
            <div class="respuesta">
                <div class="resp-grid-container">
                    <div class="resp-grid">
                        <div class="cajas">
                            <nav>
                                <div class="et-p" id="result">
                                </div>
                            </nav>
                        </div>
                        <script>
                            var searchForm = document.getElementById('input-form');
                            searchForm.addEventListener('submit', async function (event) {
                                event.preventDefault();
                                let input = searchForm.elements.input_text.value;
      
                                try {
                                    const body = {
                                        "query": input
                                    };

                                    const settings = {
                                        method: 'post',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify(body),
                                    };
                                    const res = await fetch('http://127.0.0.1:5000/chain', settings)
                                    const reader = res.body.getReader();
                                    document.getElementById("result").innerHTML = "";
                                    while (true) {
                                        const { done, value } = await reader.read();
                                        if (done) break;
                                        const text = new TextDecoder().decode(value);
                                        document.getElementById("result").innerHTML += text;
                                    }

                                } catch (error) {
                                    console.error(error);
                                }
                            });
                        </script>


</body>

</html>